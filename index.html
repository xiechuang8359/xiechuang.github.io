<!DOCTYPE html>
<html lang="zh-CN">
<head>
  <meta charset="UTF-8"> <!-- 设置文档字符编码为UTF-8 -->
  <meta name="viewport" content="width=device-width, initial-scale=1.0"> <!-- 响应式视口设置 -->
  <title>拨码器滑块修复动画</title>
  <style>
    * {
      box-sizing: border-box; /* 盒模型包含padding和border */
      margin: 0; /* 移除默认外边距 */
      padding: 0; /* 移除默认内边距 */
    }
    
    body {
      background: #f0f2f5; /* 页面背景色 */
      padding: 2vw; /* 使用视窗单位的内边距 */
      display: flex; /* 弹性布局 */
      justify-content: center; /* 水平居中 */
    }
    
    .container {
      width: 100%; /* 宽度100% */
      max-width: 640px; /* 最大宽度限制 */
      background: white; /* 白色背景 */
      padding: 2vw; /* 内边距 */
      border-radius: 1.5vw; /* 圆角边框 */
      box-shadow: 0 0 12px rgba(0,0,0,0.1); /* 阴影效果 */
    }
    
    h1 {
      font-size: 6vw; /* 响应式字体大小 */
      color: #2E7D32; /* 标题颜色 */
      text-align: center; /* 文字居中 */
      margin-bottom: 4vw; /* 底部外边距 */
    }

    .controls {
      display: flex; /* 弹性布局 */
      justify-content: center; /* 水平居中 */
      gap: 2vw; /* 子元素间距 */
      margin-bottom: 4vw; /* 底部外边距 */
    }
    
    .controls button {
      font-size: 3.5vw; /* 按钮字体大小 */
      padding: 1.5vw 2.5vw; /* 按钮内边距 */
      border: 1px solid #ccc; /* 边框样式 */
      border-radius: 1vw; /* 圆角边框 */
      background: #f5f5f5; /* 背景色 */
      cursor: pointer; /* 鼠标指针样式 */
    }
    
    .controls button.active {
      background: #4CAF50; /* 激活状态背景色 */
      color: white; /* 文字颜色 */
      border-color: #388E3C; /* 边框颜色 */
    }

    .code-bits {
      display: flex; /* 弹性布局 */
      justify-content: space-between; /* 两端对齐 */
      gap: 1vw; /* 子元素间距 */
      margin-bottom: 5vw; /* 底部外边距 */
    }

    .toggle-switch {
      position: relative; /* 相对定位 */
      aspect-ratio: 1 / 2.5; /* 宽高比 */
      flex: 1; /* 弹性项扩展 */
    }

    .toggle-switch input {
      display: none; /* 隐藏原生输入框 */
    }

    .slider {
      position: absolute; /* 绝对定位 */
      top: 0; /* 顶部对齐 */
      bottom: 0; /* 底部对齐 */
      left: 0; /* 左侧对齐 */
      right: 0; /* 右侧对齐 */
      background-color: #ccc; /* 背景色 */
      border-radius: 1vw; /* 圆角边框 */
      cursor: pointer; /* 鼠标指针样式 */
    }

    .slider:before {
      content: attr(data-label); /* 动态内容 */
      position: absolute; /* 绝对定位 */
      width: 90%; /* 宽度 */
      height: 35%; /* 高度 */
      left: 5%; /* 左侧位置 */
      top: 62%; /* 顶部位置 */
      transition: top 0.2s ease; /* 过渡动画 */
      background: white; /* 背景色 */
      border-radius: 1vw; /* 圆角边框 */
      font-weight: bold; /* 加粗字体 */
      font-size: var(--fontSize); /* 动态字体大小 */
      display: flex; /* 弹性布局 */
      align-items: center; /* 垂直居中 */
      justify-content: center; /* 水平居中 */
    }

    input:checked + .slider {
      background: linear-gradient(to bottom, #66BB6A, #4CAF50); /* 渐变背景 */
    }

    input:checked + .slider:before {
      top: 3%; /* 选中状态位置 */
    }

    .code-display {
      background: #f9f9f9; /* 背景色 */
      padding: 3vw; /* 内边距 */
      border-radius: 2vw; /* 圆角边框 */
      border: 1px solid #ddd; /* 边框样式 */
      margin-bottom: 5vw; /* 底部外边距 */
      display: flex; /* 弹性布局 */
      flex-direction: column; /* 垂直排列 */
      align-items: center; /* 水平居中 */
      gap: 3vw; /* 子元素间距 */
    }

    .code-item {
      font-size: 4.5vw; /* 字体大小 */
      font-weight: bold; /* 加粗字体 */
      color: #333; /* 文字颜色 */
      text-align: center; /* 文字居中 */
      width: 100%; /* 宽度100% */
      display: flex; /* 弹性布局 */
      justify-content: space-between; /* 两端对齐 */
      max-width: 90%; /* 最大宽度限制 */
    }

    .code-item strong {
      flex: 1; /* 弹性项扩展 */
      text-align: right; /* 文字右对齐 */
      margin-right: 2vw; /* 右侧外边距 */
    }

    .code-item span {
      flex: 1; /* 弹性项扩展 */
      text-align: left; /* 文字左对齐 */
      margin-left: 2vw; /* 左侧外边距 */
    }

    .hint {
      font-size: 3.2vw; /* 字体大小 */
      text-align: center; /* 文字居中 */
      color: #4CAF50; /* 文字颜色 */
      background: #E8F5E9; /* 背景色 */
      padding: 1.5vw 3vw; /* 内边距 */
      border-radius: 1vw; /* 圆角边框 */
    }

    .keyboard {
      display: grid; /* 网格布局 */
      grid-template-columns: repeat(3, 1fr); /* 3列网格 */
      gap: 2vw; /* 网格间距 */
    }

    .keyboard button {
      font-size: 5vw; /* 字体大小 */
      padding: 3vw 0; /* 内边距 */
      border: none; /* 无边框 */
      border-radius: 1.5vw; /* 圆角边框 */
      background: #e0e0e0; /* 背景色 */
      font-weight: bold; /* 加粗字体 */
      cursor: pointer; /* 鼠标指针样式 */
    }

    .keyboard button.clear {
      background: #FFA000; /* 特殊背景色 */
      color: white; /* 文字颜色 */
    }

    .keyboard button.delete {
      background: #EF5350; /* 特殊背景色 */
      color: white; /* 文字颜色 */
    }
  </style>
</head>
<body>
  <div class="container">
    <h1>消防电话编码</h1>
    <div class="controls" id="controlButtons"></div>
    <div class="code-bits" id="codeBitsContainer"></div>

    <div class="code-display">
      <div class="code-item"><strong>编码数值：</strong> <span id="codeValue">0000000</span></div>
      <div class="code-item"><strong>二进制值：</strong> <span id="binaryValue">0000000</span></div>
      <div class="code-item"><strong>十进制数：</strong> <span id="decimalValue">0</span></div>
      <div class="hint" id="rangeHint">请输入 0~127 范围内的数字</div>
    </div>

    <div class="keyboard">
      <button>1</button><button>2</button><button>3</button>
      <button>4</button><button>5</button><button>6</button>
      <button>7</button><button>8</button><button>9</button>
      <button class="clear">清空</button><button>0</button><button class="delete">删除</button>
    </div>
  </div>

<script>
// 定义可选的位数范围
const bitRange = [4,5,6,7,8,9,10];
// 获取DOM元素
const controlButtons = document.getElementById('controlButtons');
const codeBitsContainer = document.getElementById('codeBitsContainer');
const codeValueSpan = document.getElementById('codeValue');
const binaryValueSpan = document.getElementById('binaryValue');
const decimalValueSpan = document.getElementById('decimalValue');
const rangeHint = document.getElementById('rangeHint');
const keyboardButtons = document.querySelectorAll('.keyboard button');

// 全局变量
let currentBits = 7;  // 当前位数，默认为7

// 创建位数选择按钮
function createButtons() {
  bitRange.forEach(bits => {
    const btn = document.createElement('button');
    btn.textContent = bits + '位';
    btn.dataset.bits = bits;
    if (bits === currentBits) btn.classList.add('active');
    btn.onclick = () => {
      currentBits = bits;
      // 移除所有按钮的active类
      document.querySelectorAll('.controls button').forEach(b => b.classList.remove('active'));
      btn.classList.add('active');
      createSwitches(bits);  // 创建对应位数的拨码开关
    };
    controlButtons.appendChild(btn);
  });
}

// 创建拨码开关
function createSwitches(bits) {
  codeBitsContainer.innerHTML = '';  // 清空容器

  // 根据位数计算字体大小
  const fontSize = (3.2 * 7 / bits).toFixed(2) + 'vw';

  // 创建指定数量的开关
  for (let i = 0; i < bits; i++) {
    const label = document.createElement('label');
    label.className = 'toggle-switch';

    const input = document.createElement('input');
    input.type = 'checkbox';

    const slider = document.createElement('span');
    slider.className = 'slider';
    slider.setAttribute('data-label', i + 1);  // 设置标签内容
    slider.style.setProperty('--fontSize', fontSize);  // 设置CSS变量

    label.appendChild(input);
    label.appendChild(slider);
    codeBitsContainer.appendChild(label);
    input.addEventListener('change', updateDisplay);  // 添加事件监听
  }

  updateRangeHint(bits);  // 更新提示信息
  clearAll();  // 重置所有开关
}

// 更新显示区域
function updateDisplay() {
  const switches = document.querySelectorAll('.toggle-switch input');
  // 获取二进制字符串
  const binary = Array.from(switches).map(sw => sw.checked ? '1' : '0').join('');
  // 反转二进制字符串
  const reversed = [...binary].reverse().join('');
  // 转换为十进制
  const decimal = parseInt(reversed, 2);
  
  // 更新DOM显示
  codeValueSpan.textContent = binary;
  binaryValueSpan.textContent = reversed;
  decimalValueSpan.textContent = decimal;
}

// 处理数字输入
function processInput() {
  const num = parseInt(decimalValueSpan.textContent);
  const maxVal = Math.pow(2, currentBits) - 1;
  
  // 验证输入范围
  if (isNaN(num) || num < 0 || num > maxVal) {
    clearAll();
    return;
  }
  
  // 转换为二进制并设置开关状态
  const binary = num.toString(2).padStart(currentBits, '0');
  const switches = document.querySelectorAll('.toggle-switch input');
  switches.forEach((sw, i) => {
    sw.checked = binary[currentBits - 1 - i] === '1';
  });
  updateDisplay();
}

// 清空所有开关和输入
function clearAll() {
  const switches = document.querySelectorAll('.toggle-switch input');
  switches.forEach(sw => {
    sw.checked = false;
  });
  updateDisplay();
}

// 更新范围提示
function updateRangeHint(bits) {
  const max = Math.pow(2, bits) - 1;
  rangeHint.textContent = `请输入 0~${max} 范围内的数字`;
}

// 为键盘按钮添加事件监听
keyboardButtons.forEach(button => {
  button.addEventListener('click', () => {
    const value = button.textContent;
    if (!isNaN(parseInt(value))) {
      // 数字按钮处理
      const current = decimalValueSpan.textContent;
      decimalValueSpan.textContent = current === '0' ? value : current + value;
      processInput();
    } else if (button.classList.contains('clear')) {
      // 清空按钮
      clearAll();
    } else if (button.classList.contains('delete')) {
      // 删除按钮
      const current = decimalValueSpan.textContent;
      decimalValueSpan.textContent = current.length > 1 ? current.slice(0, -1) : '0';
      processInput();
    }
  });
});

// 初始化
createButtons();
createSwitches(currentBits);
</script>
</body>
</html>
